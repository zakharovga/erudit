$(document).ready(function(){var h,a={},b=[],c=$("#modal-error"),d=$("#modal-error-body"),e=$("#modal-waiting"),f=$("#modal-players"),g=$(".pending-game-div");if(!("WebSocket"in window))return d.text("\u0412\u0435\u0431\u0441\u043e\u043a\u0435\u0442\u044b \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u044d\u0442\u0438\u043c \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 Internet Explorer 10 \u0438\u043b\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0432\u0435\u0440\u0441\u0438\u0438 Mozilla Firefox \u0438\u043b\u0438 Google Chrome."),void c.modal("show");var i=function(a){a?($("#player-status").removeClass("status-not-ready glyphicon-remove").addClass("status-ready glyphicon-ok"),$("#player-modal").addClass("selected")):($("#player-status").removeClass("status-ready glyphicon-ok").addClass("status-not-ready glyphicon-remove"),$("#player-modal").removeClass("selected"))},j=function(a,b){b?($("#opponent"+a+"-status").removeClass("status-not-ready glyphicon-remove").addClass("status-ready glyphicon-ok"),$("#opponent"+a+"-modal").addClass("selected")):($("#opponent"+a+"-status").removeClass("status-ready glyphicon-ok").addClass("status-not-ready glyphicon-remove"),$("#opponent"+a+"-modal").removeClass("selected"))},k=function(b){e.modal("hide"),f.modal({keyboard:!1,backdrop:"static",show:!0}),a.email=b.email,a.guest=b.guest,a.rating=Math.round(b.rating),a.username=b.username,$("#player-name-modal").text(a.username),$("#player-rating").text(a.rating),$("#player-modal").fadeIn("slow")},l=function(c,d){e.modal("hide"),f.modal({keyboard:!1,backdrop:"static",show:!0}),a.email=c.email,a.guest=c.guest,a.rating=Math.round(c.rating),a.username=c.username,$("#player-name-modal").text(a.username),$("#player-rating").text(a.rating),$("#player-modal").fadeIn("slow");for(var g=0;g<d.length;g++){b[g]=d[g],$("#opponent"+g+"-name-modal").text(d[g].user.username),$("#opponent"+g+"-rating").text(Math.round(d[g].user.rating));var h=$("#opponent"+g+"-modal");j(g,d[g].ready),h.fadeIn("slow")}},m=function(a){var c={user:a,ready:!1};b.push(c);var d=b.length-1;$("#opponent"+d+"-rating").text(Math.round(a.rating)),$("#opponent"+d+"-name-modal").text(a.username),$("#opponent"+d+"-modal").fadeIn("slow")},n=function(a,b){try{if("CREATE"==a)return console.log(location.pathname),h=new WebSocket("ws://"+window.location.host+location.pathname+"?action="+a);if("JOIN"==a)return h=new WebSocket("ws://"+window.location.host+location.pathname+"?action="+a+"&gameid="+b)}catch(c){throw c}},o=function(a){for(var c,d=0;d<b.length;d++)$opponent=$("#opponent"+d+"-modal"),b[d].user.username==a&&(c=d,$opponent.removeClass("selected"),$("#opponent"+d+"-status").removeClass("status-ready glyphicon-ok").addClass("status-not-ready glyphicon-remove")),$opponent.hide();b.splice(c,1);for(var e=0;e<b.length;e++)$("#opponent"+e+"-name-modal").text(b[e].username),$("#opponent"+e+"-modal").fadeIn()},p=function(a){var b="start",c=$('<form id="redirectForm" method="post"></form>').attr({action:b,style:"display: none"});c.append($('<input type="hidden">').attr({name:"gameId",value:a})),$("body").append(c),c.submit()},q=function(){h.onmessage=function(a){var c=JSON.parse(a.data);if("PLAYER_CREATED"==c.action)return void k(c.player);if("PLAYER_JOINED"==c.action)return void l(c.player,c.opponents);if("OPPONENT_JOINED"==c.action)return void m(c.player);if("OPPONENT_QUIT"==c.action)return void o(c.opponent);if("OPPONENT_READY"==c.action){for(var d,e=c.ready,f=0;f<b.length;f++)if(b[f].user.username==c.opponent){d=f;break}e?($("#opponent"+f+"-modal").addClass("selected"),$("#opponent"+f+"-status").removeClass("status-not-ready glyphicon-remove").addClass("status-ready glyphicon-ok")):($("#opponent"+f+"-modal").removeClass("selected"),$("#opponent"+f+"-status").removeClass("status-ready glyphicon-ok").addClass("status-not-ready glyphicon-remove"))}"PLAYER_REDIRECTED"==c.action&&p(c.gameId)},window.onbeforeunload=function(){h.onclose=function(){},h.close()},h.onclose=function(a){b=[],a.wasClean?(f.modal("hide"),e.modal("hide"),d.text(a.reason),c.modal("show")):(f.modal("hide"),e.modal("hide"),d.text("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u0440\u0430\u0437\u043e\u0440\u0432\u0430\u043d\u043e. \u041a\u043e\u0434 "+a.code+": "+a.reason),c.modal("show"))},h.onerror=function(a){b=[],e.modal("hide"),d.text("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 "+a.data),c.modal("show")}},r=function(a){a.preventDefault();try{e.modal("show"),h=n("CREATE"),h.onopen=function(){e.modal("hide"),f.modal({keyboard:!1,backdrop:"static",show:!0}),$("#player-modal").show()},q()}catch(b){e.modal("hide"),d.text(b),c.modal("show")}},s=function(a){try{e.modal("show"),h=n("JOIN",a),h.onopen=function(){$("#player-modal").show()},q()}catch(b){e.modal("hide"),d.text(b),c.modal("show")}};g.each(function(){for(var a=$(this),b=a.attr("numPlayers"),c=0;c<b;c++)a.find("span").eq(c).removeClass("free-icon").addClass("busy-icon")}),$("#pager").find("li a").click(function(a){a.preventDefault()});var t=function(a,b){var c=0,d=a.children(),e=d.size(),g=(Math.ceil(e/b),$("#pager")),h=g.children().eq(0),i=g.children().eq(1);d.hide(),d.slice(0,b).show(),e>b&&i.removeClass("disabled");var j=function(){h.removeClass("disabled"),c+=b;var a=0;c+b<e?(a=c+b-1,d.css("display","none").slice(c,a+1).show()):(a=e-1,d.css("display","none").slice(c).show(),i.addClass("disabled"))},k=function(){i.removeClass("disabled"),c-=b;var a=0;c>0?(a=c+b-1,d.css("display","none").slice(c,a+1).show()):(a=c+b-1,d.css("display","none").slice(c,a+1).show(),h.addClass("disabled"))};i.click(function(){return $(this).hasClass("disabled")?!1:(j(),!1)}),h.click(function(){return $(this).hasClass("disabled")?!1:(k(),!1)})};t($("#game-list"),10),$("#create-game-btn").click(r),g.click(function(){return s($(this).attr("gameId")),!1}),$("#ready-radio").find(":input").change(function(){$(this).is("#ready-input")?(i(!0),h.send(JSON.stringify({action:"OPPONENT_READY",readyOpponent:a.username,ready:!0}))):(i(!1),h.send(JSON.stringify({action:"OPPONENT_READY",readyOpponent:a.username,ready:!1})))}),$("#cancel").click(function(){b=[],$("#ready-label").removeClass("active"),$("#not-ready-label").addClass("active"),$("#not-ready-input").attr("checked","checked"),$("#ready-input").removeAttr("checked"),i(!1);for(var a=0;a<b.length;a++)j(a,!1);$("#player-modal, .opponent-modal").hide(),h.onclose=function(){},h.close(),f.modal("hide")})});